slot0 = class("Task", import(".BaseVO"))
slot1 = {
	"scenario",
	"branch",
	"routine",
	"weekly"
}

slot0.Ctor = function (slot0, slot1)
	slot0.id = slot1.id
	slot0.configId = slot1.id
	slot0.progress = slot1.progress or 0
	slot0.acceptTime = slot1.accept_time
	slot0.submitTime = slot1.submit_time or 0
end

slot0.bindConfigTable = function (slot0)
	return pg.task_data_template
end

slot0.isFinish = function (slot0)
	slot1 = slot0.progress

	if slot0:getConfig("sub_type") == TASK_SUB_TYPE_GIVE_ITEM then
		slot1 = getProxy(BagProxy):getItemCountById(tonumber(slot0:getConfig("target_id_for_client")))
	elseif slot0:getConfig("sub_type") == TASK_SUB_TYPE_PLAYER_RES then
		slot1 = getProxy(PlayerProxy):getData():getResById(slot0:getConfig("target_id_for_client"))
	end

	if slot0:getConfig("sub_type") == TASK_SUB_TYPE_PT and getProxy(ActivityProxy):getActivityByType(ActivityConst.ACTIVITY_TYPE_PT_RANK) then
		slot1 = slot2.data1
	end

	return slot0:getConfig("target_num") <= slot1
end

slot0.getProgress = function (slot0)
	slot1 = slot0.progress

	if slot0:getConfig("sub_type") == TASK_SUB_TYPE_GIVE_ITEM then
		slot1 = getProxy(BagProxy):getItemCountById(tonumber(slot0:getConfig("target_id_for_client")))
	elseif slot0:getConfig("sub_type") == TASK_SUB_TYPE_PT then
		if getProxy(ActivityProxy):getActivityByType(ActivityConst.ACTIVITY_TYPE_PT_RANK) then
			slot1 = slot2.data1
		end
	elseif slot0:getConfig("sub_type") == TASK_SUB_TYPE_PLAYER_RES then
		slot1 = getProxy(PlayerProxy):getData():getResById(slot0:getConfig("target_id_for_client"))
	end

	return slot1
end

slot0.isReceive = function (slot0)
	return slot0.submitTime > 0
end

slot0.getTaskStatus = function (slot0)
	if slot0:isReceive() then
		return 2
	end

	if slot0:isFinish() then
		return 1
	end

	return 0
end

slot0.onAdded = function (slot0)
	function slot1()
		if slot0:getConfig("sub_type") == 29 then
			pg.m02:sendNotification(GAME.TASK_GO, {
				taskVO = pg.m02.sendNotification
			})
		elseif slot0:getConfig("added_tip") > 0 then
			slot0 = nil

			if getProxy(ContextProxy).getCurrentContext(slot1).mediator.__cname ~= TaskMediator.__cname then
				function slot0()
					pg.m02:sendNotification(GAME.GO_SCENE, SCENE.TASK, {
						page = slot0[slot1:getConfig("type")]
					})
				end
			end

			pg.MsgboxMgr.GetInstance():ShowMsgBox({
				noText = "text_iknow",
				yesText = "text_forward",
				content = i18n("tip_add_task", HXSet.hxLan(slot0:getConfig("name"))),
				onYes = slot0
			})
		end
	end

	if slot0:getConfig("story_id") and slot2 ~= "" then
		pg.StoryMgr.GetInstance():PlayOnTaskAdded(slot2, slot1, true, true)
	else
		slot1()
	end
end

return slot0

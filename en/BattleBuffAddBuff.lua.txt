ys = ys or {}
slot1 = class("BattleBuffAddBuff", ys.Battle.BattleBuffEffect)
ys.Battle.BattleBuffAddBuff = slot1
slot1.__name = "BattleBuffAddBuff"

slot1.Ctor = function (slot0, slot1)
	slot0.Battle.BattleBuffAddBuff.super.Ctor(slot0, slot1)
end

slot1.SetArgs = function (slot0, slot1, slot2)
	slot0._level = slot2:GetLv()
	slot0._buff_id = slot0._tempData.arg_list.buff_id
	slot0._target = slot0._tempData.arg_list.target or "TargetSelf"
	slot0._time = slot3.time or 0
	slot0._rant = slot3.rant or 10000
	slot0._hpRatioList = slot3.hpRatioList or {}
	slot0._nextEffectTime = pg.TimeMgr.GetInstance():GetCombatTime() + slot0._time
	slot0._check_target = slot3.check_target
	slot0._minTargetNumber = slot3.minTargetNumber or 0
	slot0._isBuffStackByCheckTarget = slot3.isBuffStackByCheckTarget
	slot0._countType = slot3.countType
	slot0._weaponType = slot0._tempData.arg_list.weaponType
end

slot1.onUpdate = function (slot0, slot1, slot2, slot3)
	if slot0._nextEffectTime <= slot3 then
		slot1:AddBuff(slot0.Battle.BattleBuffUnit.New(slot0._buff_id, slot0._level, slot0._caster))

		slot0._nextEffectTime = slot3 + slot0._time
	end
end

slot1.onBulletHit = function (slot0, slot1, slot2, slot3)
	if not slot0:equipIndexRequire(slot3.equipIndex) then
		return
	end

	slot4 = slot3.target

	if (not slot0._weaponType or slot3.weaponType == slot0._weaponType) and slot0.Battle.BattleFormulas.IsHappen(slot0._rant) and slot4:IsAlive() then
		slot4:AddBuff(slot0.Battle.BattleBuffUnit.New(slot0._buff_id, slot0._level, slot0._caster))
	end
end

slot1.onBulletCreate = function (slot0, slot1, slot2, slot3)
	if not slot0:equipIndexRequire(slot3.equipIndex) then
		return
	end

	slot5 = slot0._buff_id
	slot6 = slot0._level

	slot3._bullet:SetBuffFun(slot0._tempData.arg_list.bulletTrigger, function (slot0, slot1)
		slot0:AddBuff(slot0.Battle.BattleBuffUnit.New(slot1, slot0.Battle.BattleBuffUnit.New, slot3._caster))
	end)
end

slot1.onTrigger = function (slot0, slot1, slot2, slot3)
	slot0.super.onTrigger(slot0, slot1, slot2, slot3)
	slot0:AddBuff(slot1)
end

slot1.AddBuff = function (slot0, slot1)
	if slot0._check_target then
		if slot0._minTargetNumber <= #slot0:getTargetList(slot1, slot0._check_target, slot0._tempData.arg_list) then
			for slot8, slot9 in ipairs(slot4) do
				if slot0._isBuffStackByCheckTarget then
					slot9:SetBuffStack(slot0._buff_id, slot0._level, slot3)
				else
					slot9:AddBuff(slot0.Battle.BattleBuffUnit.New(slot0._buff_id, slot0._level, slot0._caster))
				end
			end
		end
	else
		for slot6, slot7 in ipairs(slot2) do
			slot7:AddBuff(slot0.Battle.BattleBuffUnit.New(slot0._buff_id, slot0._level, slot0._caster))
		end
	end
end

slot1.Dispose = function (slot0)
	slot0.Battle.BattleBuffAddBuff.super:Dispose()
	pg.TimeMgr.GetInstance():RemoveBattleTimer(slot0._timer)

	slot0._timer = nil
end

return
